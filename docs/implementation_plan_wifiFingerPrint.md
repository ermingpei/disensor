# å®æ–½è®¡åˆ’ - WiFi æŒ‡çº¹ (WiFi Fingerprinting)

## ç›®æ ‡æè¿°
å®ç° WiFi æŒ‡çº¹ (WiFi Fingerprinting) åŠŸèƒ½ï¼Œæ‰«æå¯è§çš„ WiFi çƒ­ç‚¹ (BSSID, RSSI, SSID)ï¼Œä»¥å®ç°ç²¾ç¡®çš„å®¤å†…å®šä½å’Œâ€œä½ç½®è¯æ˜ (Proof of Location)â€ã€‚è¿™å°†æŠŠåº”ç”¨ç¨‹åºè½¬å˜ä¸ºå…·æœ‰æé«˜å•†ä¸šä»·å€¼çš„â€œç½‘ç»œåœ°å›¾ç»˜åˆ¶è€…â€ã€‚

## æ ¸å¿ƒä»·å€¼ä¸ç”¨é€” (Value & Use Cases)

### 1. å®ƒæ˜¯ DePIN çš„é˜²ä¼ªæ ¸å¿ƒ (Anti-Spoofing)
*   **GPS çš„çŸ­æ¿**: GPS åæ ‡éå¸¸å®¹æ˜“ä¼ªé€ ï¼ˆæ¨¡æ‹Ÿä½ç½®ï¼‰ã€‚ä»…ä»…ä¸ŠæŠ¥ç»çº¬åº¦å¹¶ä¸èƒ½è¯æ˜ä½ å°±åœ¨é‚£é‡Œã€‚
*   **æŒ‡çº¹çš„å”¯ä¸€æ€§**: å½“æ‚¨æ‰«æ WiFi æ—¶ï¼Œæ‚¨ä¸ä»…ä»…æ˜¯çœ‹åˆ°â€œå®¶é‡Œ WiFiâ€ï¼Œæ‚¨çœ‹åˆ°çš„æ˜¯å‘¨å›´æ‰€æœ‰è·¯ç”±å™¨çš„ **MAC åœ°å€ (BSSID)** å’Œ**ä¿¡å·å¼ºåº¦ (RSSI)** çš„ç‹¬ç‰¹ç»„åˆã€‚
*   **ä½ç½®è¯æ˜ (Proof of Location)**: è¿™ç§ç»„åˆå°±åƒâ€œå°„é¢‘æŒ‡çº¹â€ä¸€æ ·ã€‚åœ¨çº½çº¦å’–å•¡é¦†å’Œä¸œäº¬åŠå…¬å®¤ï¼Œè¿™ä¸ªç»„åˆæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œè€Œä¸”å¾ˆéš¾é€šè¿‡è½¯ä»¶å®æ—¶ä¼ªé€ ä¸€ä¸ªçœŸå®å¤æ‚çš„ç¯å¢ƒä¿¡å·ã€‚è¿™è®©æ‚¨çš„èŠ‚ç‚¹æ•°æ®å¯ä¿¡åº¦æå‡ 100 å€ã€‚

### 2. å•†ä¸šä»·å€¼ï¼šå®¤å†…å®šä½ (Indoor Positioning)
*   **å®¤å†…ç›²åŒº**: GPS åœ¨å®¤å†…ã€åœ°ä¸‹å®¤ã€å•†åœºé‡Œå¾€å¾€å¤±æ•ˆã€‚
*   **ç½‘ç»œåœ°å›¾**: é€šè¿‡ WiFi æŒ‡çº¹ï¼Œæ‚¨çš„ App å¯ä»¥ç»˜åˆ¶å‡ºå»ºç­‘å†…éƒ¨çš„ä¿¡å·çƒ­åŠ›å›¾ã€‚è¿™æ˜¯ Google Mapsã€é«˜å¾·åœ°å›¾ç­‰å·¨å¤´éå¸¸æ¸´æœ›çš„æ•°æ®ã€‚
*   **ä»â€œæµ‹é€Ÿâ€åˆ°â€œæµ‹ç»˜â€**: è¿™è®©æ‚¨çš„ App æ‹¥æœ‰äº†ç»˜åˆ¶ç‰©ç†ä¸–ç•Œâ€œæ•°å­—å­ªç”Ÿâ€çš„èƒ½åŠ›ã€‚

## iOS é™åˆ¶è¯¦è§£ (iOS Limitations)
> [!NOTE]
> **ç”¨æˆ·ç–‘é—®**: "ä¸ºä»€ä¹ˆé€šè¿‡è®¾ç½®èƒ½çœ‹åˆ° WiFi åˆ—è¡¨ï¼ŒApp å´çœ‹ä¸åˆ°ï¼Ÿ"

*   **ç³»ç»Ÿçº§ vs åº”ç”¨çº§**: iOS çš„**è®¾ç½®é¡µé¢**æ˜¯ç³»ç»Ÿçº§åº”ç”¨ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ã€‚ä½† Apple å‡ºäºéšç§ä¿æŠ¤ï¼ˆé˜²æ­¢å¹¿å‘Šå•†è¿½è¸ªç”¨æˆ·ä½ç½®ï¼‰ï¼Œ**ä¸¥ç¦æ™®é€š App è·å–å‘¨å›´ WiFi åˆ—è¡¨**ã€‚
*   **ç›®å‰çš„æƒé™**:
    *   **Android**: å…è®¸ App æ‰«æå‘¨å›´æ‰€æœ‰ç½‘ç»œï¼ˆéœ€è¦ä½ç½®æƒé™ï¼‰ã€‚
    *   **iOS**: ä»…å…è®¸ App è·å–**å½“å‰è¿æ¥çš„é‚£ä¸ª WiFi** çš„åç§° (SSID) å’Œåœ°å€ (BSSID)ã€‚è€Œä¸”éœ€è¦ç”³è¯·æå…¶ç‰¹æ®Šçš„ "Hotspot Helper" æƒé™æ‰èƒ½è¿›è¡Œæ›´æ·±åº¦çš„æ“ä½œï¼Œè¿™é€šå¸¸åªå¼€æ”¾ç»™ç½‘ç»œç®¡ç†ç±» Appã€‚
*   **æŠ€æœ¯å·®å¼‚**: æ‰€è°“â€œæŒ‡çº¹â€ï¼Œéœ€è¦çš„æ˜¯**å¤šä¸ª**ç‚¹ï¼ˆå‘¨å›´çš„é‚»å±…ç½‘ç»œï¼‰æ¥ä¸‰è§’å®šä½ã€‚å¦‚æœæ˜¯ iOS åªèƒ½æ‹¿åˆ°**ä¸€ä¸ª**ç‚¹ï¼ˆå½“å‰è¿æ¥çš„ï¼‰ï¼Œå®ƒä½œä¸ºä¸€ä¸ªâ€œæŒ‡çº¹â€æ˜¯éå¸¸å¼±çš„ï¼Œä»·å€¼å¤§æ‰“æŠ˜æ‰£ã€‚å› æ­¤æˆ‘ä»¬ç›®å‰çš„å®ç°ä¸»è¦ä¾§é‡äº Android çš„å®Œæ•´æ‰«æèƒ½åŠ›ã€‚

## æœ€ä½³åº”ç”¨åœºæ™¯ (Killer Applications)

### 1. å®¤å†…å¯¼èˆªä¸å®¢æµåˆ†æ (The "Google Maps for Indoors")
*   **åœºæ™¯**: å•†åœºã€æœºåœºã€å¤§å‹å±•ä¼šã€åœ°ä¸‹åœè½¦åœºã€‚
*   **ç—›ç‚¹**: è§£å†³ GPS åœ¨å®¤å†…çš„å¤±æ•ˆé—®é¢˜ï¼Œå¸®åŠ©ç”¨æˆ·æ‰¾åˆ°åº—é“ºæˆ–åœè½¦ä½ã€‚
*   **ä»·å€¼**: æä¾›ç²¾ç¡®çš„æ¥¼å±‚è¯†åˆ«ï¼ˆæ°”å‹è®¡ï¼‰å’Œåº—é“ºçº§å®šä½ã€‚æ•°æ®å¯å‡ºå”®ç»™åœ°å›¾æœåŠ¡å•†æˆ–å•†åœºè¿è¥æ–¹ã€‚

### 2. ä½ç½®è¯æ˜ (Proof of Location) - é˜²ä½œå¼Šç¥å™¨
*   **åœºæ™¯**: é›¶å·¥ç»æµéªŒè¯ã€é‡‘èåæ¬ºè¯ˆã€GameFiã€‚
*   **ç—›ç‚¹**: æ‰“å‡» GPS ä¼ªé€ å’Œæ¨¡æ‹Ÿå™¨ä½œå¼Šã€‚
*   **ä»·å€¼**: ç”Ÿæˆä¸å¯ä¼ªé€ çš„ä½ç½®è¯ä¹¦ã€‚WiFi æŒ‡çº¹çš„å¤æ‚æ€§å’Œæ—¶å˜æ€§æ˜¯éªŒè¯â€œçœŸäººçœŸåœ°â€çš„é»„é‡‘æ ‡å‡†ï¼Œç‰¹åˆ«é€‚åˆä½œä¸º Web3 é¢„è¨€æœºæœåŠ¡ã€‚

### 3. æ™ºèƒ½åœºæ™¯è§¦å‘ (Hyper-Local Automation)
*   **åœºæ™¯**: æ™ºèƒ½å®¶å±…ã€åšç‰©é¦†å¯¼è§ˆã€‚
*   **ä»·å€¼**: åŒºåˆ†â€œå§å®¤â€ä¸â€œå®¢å…â€è¿™ç§ GPS æ— æ³•åšåˆ°çš„ç»†ç²’åº¦ã€‚å®ç°èµ°è¿‘å±•å“è‡ªåŠ¨è®²è§£ç­‰è¶…æœ¬åœ°åŒ–è‡ªåŠ¨åŒ–æœåŠ¡ã€‚

### 4. èµ„äº§è¿½è¸ª (Asset Tracking)
*   **åœºæ™¯**: åŒ»é™¢è®¾å¤‡ç®¡ç†ã€ä»“å‚¨ç‰©æµã€‚
*   **ä»·å€¼**: ç»“åˆè“ç‰™å’Œ WiFiï¼Œç²¾ç¡®å®šä½ç‰©å“æ‰€åœ¨çš„å…·ä½“æˆ¿é—´ã€‚ç›¸æ¯” AirTagï¼Œè¿™æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å…¨çƒè¿½è¸ªç½‘ç»œã€‚

### 5. ç½‘ç»œè´¨é‡çƒ­åŠ›å›¾ (Network Quality Mapping)
*   **åœºæ™¯**: å¸®åŠ© ISP ä¼˜åŒ–ç½‘ç»œã€å¸®åŠ©ç”¨æˆ·å¯»æ‰¾æœ€ä½³åŠå…¬åœ°ç‚¹ã€‚
*   **ä»·å€¼**: é€šè¿‡æµ·é‡ä¼—åŒ…æ•°æ®ï¼Œç»˜åˆ¶å‡ºçœŸå®ä¸–ç•Œçš„ä¿¡å·æ­»è§’å’Œä¼˜è´¨ç½‘ç»œåŒºåŸŸå›¾ã€‚

## éœ€è¦ç”¨æˆ·å®¡æŸ¥
> [!IMPORTANT]
> **æ•°æ®åº“æ¶æ„æ›´æ–°**: Supabase ä¸­çš„ `readings` è¡¨å¯èƒ½éœ€è¦ä¸€ä¸ªæ–°çš„åˆ— `wifi_data` (ç±»å‹ä¸º `jsonb`) æ¥å­˜å‚¨æŒ‡çº¹æ•°æ®ã€‚å¦‚æœæ’å…¥å¤±è´¥ï¼Œæ‚¨å¯èƒ½éœ€è¦æ‰‹åŠ¨å°†æ­¤åˆ—æ·»åŠ åˆ°æ‚¨çš„ Supabase è¡¨ä¸­ã€‚

> [!WARNING]
> **iOS é™åˆ¶**: iOS ä¸¥é‡é™åˆ¶äº†å¯¹ WiFi æ‰«æçš„è®¿é—®ã€‚è¯¥åº”ç”¨ç¨‹åºå¯èƒ½åªèƒ½åœ¨ Android ä¸Šæ‰«æç½‘ç»œã€‚åœ¨ iOS ä¸Šï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„æƒåˆ© (`com.apple.developer.networking.HotspotHelper`)ï¼Œæˆ‘ä»¬è¦ä¹ˆåªèƒ½è·å–*å½“å‰*è¿æ¥çš„ç½‘ç»œä¿¡æ¯ï¼Œè¦ä¹ˆä»€ä¹ˆä¹Ÿè·å–ä¸åˆ°ã€‚å®ç°å°†ä¼˜é›…åœ°å¤„ç†è¿™ç§æƒ…å†µã€‚

## æ‹Ÿè®®çš„å˜æ›´

### ä¾èµ–é¡¹ (Dependencies)
#### [ä¿®æ”¹] [pubspec.yaml](file:///Users/erming/AI/pooling/sensor-sentinel/pubspec.yaml)
- æ·»åŠ  `wifi_scan: ^0.5.0` (æˆ–å…¼å®¹ç‰ˆæœ¬)ã€‚

### é€»è¾‘å±‚ (Logic Layer)
#### [æ–°å¢] [lib/features/wifi_scanner_service.dart](file:///Users/erming/AI/pooling/sensor-sentinel/lib/features/wifi_scanner_service.dart)
- åˆ›å»ºä¸€ä¸ªæœåŠ¡æ¥å°è£… `wifi_scan` æ’ä»¶ã€‚
- å®ç° `startScan()` (å¼€å§‹æ‰«æ), `getScannedResults()` (è·å–æ‰«æç»“æœ)ã€‚
- å¤„ç†æƒé™ (ç‰¹åˆ«æ˜¯é’ˆå¯¹ Android 10+ çš„é™åˆ¶å’Œè¦æ±‚)ã€‚

#### [ä¿®æ”¹] [lib/core/sensor_manager.dart](file:///Users/erming/AI/pooling/sensor-sentinel/lib/core/sensor_manager.dart)
- åˆå§‹åŒ– `WifiScannerService`ã€‚
- ä¸å…¶ä»–ä¼ æ„Ÿå™¨ä¸€èµ·ï¼Œå®šæœŸ (ä¾‹å¦‚æ¯ 30 ç§’æˆ–åœ¨é‡å¤§ç§»åŠ¨æ—¶) è§¦å‘ WiFi æ‰«æã€‚
- æ”¶é›†ç»“æœå¹¶å‡†å¤‡ä¸Šä¼ ã€‚

#### [ä¿®æ”¹] [lib/core/data_sync_service.dart](file:///Users/erming/AI/pooling/sensor-sentinel/lib/core/data_sync_service.dart)
- æ›´æ–° `uploadReading` ä»¥æ¥å— `List<Map<String, dynamic>>? wifiFingerprint`ã€‚
- å°†æ­¤æ•°æ®ä½œä¸º `wifi_data` åŒ…å«åœ¨ Supabase æ’å…¥è´Ÿè½½ä¸­ã€‚

### é…ç½® (Configuration)
#### [ä¿®æ”¹] [android/app/src/main/AndroidManifest.xml](file:///Users/erming/AI/pooling/sensor-sentinel/android/app/src/main/AndroidManifest.xml)
- æ·»åŠ  `ACCESS_WIFI_STATE` å’Œ `CHANGE_WIFI_STATE` æƒé™ã€‚

#### [ä¿®æ”¹] [ios/Runner/Info.plist](file:///Users/erming/AI/pooling/sensor-sentinel/ios/Runner/Info.plist)
- ç¡®ä¿ä½ç½®æƒé™é”®å­˜åœ¨ (å·²ç»å­˜åœ¨)ã€‚

## éªŒè¯è®¡åˆ’ (Verification Plan)

### è‡ªåŠ¨åŒ–æµ‹è¯•
- ç¡¬ä»¶ä¼ æ„Ÿå™¨æš‚æ— å¯ç”¨æµ‹è¯•ã€‚

### æ‰‹åŠ¨éªŒè¯
1.  **æƒé™æ£€æŸ¥**: åœ¨ Android/æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚éªŒè¯å®ƒæ˜¯å¦è¯·æ±‚ä½ç½®æƒé™ (å¦‚æœå°šæœªæˆäºˆ)ã€‚
2.  **æ—¥å¿—éªŒè¯**: æ£€æŸ¥ç»ˆç«¯ä¸­çš„ `debugPrint` æ—¥å¿—ã€‚
    - å¯»æ‰¾ "ğŸš€ Starting WiFi Scan" (å¼€å§‹ WiFi æ‰«æ)
    - å¯»æ‰¾ "ğŸ“¡ Found X WiFi networks" (å‘ç° X ä¸ª WiFi ç½‘ç»œ)
    - å¯»æ‰¾ "BSSID: ... RSSI: ..."
3.  **ä¸Šä¼ éªŒè¯**:
    - è§¦å‘ä¸Šä¼  (ç­‰å¾…æˆ–å¼ºåˆ¶ç§»åŠ¨)ã€‚
    - æ£€æŸ¥æ—¥å¿—ä¸­çš„ "ğŸš€ Uploading: ..."ã€‚
    - éªŒè¯è´Ÿè½½æ˜¯å¦åŒ…å« `wifi_data` (å¦‚æœå¯ä»¥é€šè¿‡æ—¥å¿—æ£€æŸ¥)ã€‚
