# 中国国内安卓机型优化指南 (China Android Optimization Guide)

由于国内安卓系统（Huawei HarmonyOS, Xiaomi HyperOS, OPPO/Vivo ColorOS/OriginOS）对后台应用的电池管理非常严格，且普遍缺乏 Google Play 服务。为了确保 DiSensor 在国内能够稳定挖矿并准确记录轨迹，**必须**引导用户进行以下手动设置。

---

## 🛰️ 关于北斗卫星系统 (BeiDou)
**用户常问：** "我的手机可以用北斗定位吗？"
**回答：** **可以，而且是自动的。**

*   **原理**：DiSensor 调用的是手机底层的 GNSS (全球导航卫星系统) 接口。
*   **硬件支持**：几乎所有国产主流手机（华为、小米、OV）的定位芯片本身就同时支持 GPS、北斗 (BeiDou)、格洛纳斯 (GLONASS) 和 伽利略 (Galileo)。
*   **App 行为**：App 不需要专门写代码去"连接"北斗。只要手机硬件支持，DiSensor 获取的坐标就是混合了北斗卫星数据的高精度坐标。
*   **注意**：在室内时，由于卫星信号被遮挡，国内手机可能会因为缺少 Google 定位辅助（AGPS 依赖）而导致定位较慢。请建议用户**在窗边或户外**启动挖矿。

---

## 🛡️ 防杀后台设置指南 (必读)
*请将此部分内容复制给用户，或制作成常见问题图片。*

### 1. 华为 (Huawei) / 荣耀 (HarmonyOS/EMUI)
华为系统的后台查杀最为严格，必须进行两步设置。
1.  **允许后台活动**：
    *   `手机管家` -> `应用启动管理`。
    *   找到 `DiSensor`，**关闭**右侧开关（变成手动管理）。
    *   在弹出的窗口中，**勾选全部三个选项**：[允许自启动]、[允许关联启动]、[允许后台活动]。
2.  **锁定任务**：
    *   从屏幕底部上滑并停顿，进入"最近任务"界面。
    *   找到 DiSensor 卡片，向下滑动或点击右上角锁图标，确保卡片上出现🔒。

### 2. 小米 (Xiaomi) / 红米 (HyperOS/MIUI)
1.  **无限制省电**：
    *   `设置` -> `省电与电池` -> 点击右上角齿轮图标 -> `应用智能省电`。
    *   找到 `DiSensor`，选择 **[无限制]**。
2.  **自启动权限**：
    *   `手机管家` -> `应用管理` -> `权限` -> `自启动管理`。
    *   开启 `DiSensor` 的开关。

### 3. OPPO / Vivo / OnePlus
1.  **允许后台高耗电**：
    *   `设置` -> `电池` -> `耗电保护`。
    *   找到 `DiSensor`，开启 **[允许后台运行]**。
2.  **锁定后台**：
    *   打开最近任务列表，点击 DiSensor 旁边的菜单/两点图标，选择 **[锁定]**。

---

## ⚡️ 网络与权限常见问题

### Q: 为什么显示"无网络"？
*   **原因**：因为众所周知的原因，连接 Google 等海外服务器受阻。
*   **解决**：v1.0.3 版本已针对国内网络优化，将连通性检测服务器改为微软 (Microsoft)，无需梯子即可显示网络正常。

### Q: 地图为什么是黑的/加载慢？
*   **原因**：Google Maps 在国内无法使用。
*   **解决**：我们使用的是 OpenStreetMap (OSM)，在国内可以直接访问。如果加载慢，请尝试切换 WiFi 或 5G 网络。

### Q: 为什么一直转圈获取不到位置？
*   **原因**：国产手机没有 Google 辅助定位服务 (AGPS)，且在室内收不到卫星信号。
*   **解决**：
    1. 确保授予了**[始终允许]**的位置权限（不仅仅是"仅使用期间"）。
    2. 请尝试走到**阳台或户外**空旷处，第一次定位可能需要 1-2 分钟来搜索北斗卫星。

---

## 🛠️ 开发者技术备注 (对于构建 APK)
如果你自己在编译 APK 发给国内用户，请注意：

1.  **构建命令**：
    使用 `flutter build apk --release --no-tree-shake-icons`
    *生成的 APK 位于 `build/app/outputs/flutter-apk/app-release.apk`*

2.  **签名**：
    Debug 版的 APK 在某些国产手机上可能会被报毒或无法安装。建议配置正式的 Keystore 签名。

3.  **权限声明**：
    Android 10+ 需要前台服务权限 (`FOREGROUND_SERVICE`) 来保活，我们已经在 `AndroidManifest.xml` 中配置好了，配合手机的白名单设置即可生效。
